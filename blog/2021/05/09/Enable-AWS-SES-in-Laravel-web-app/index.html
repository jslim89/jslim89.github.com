<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Enable AWS SES in Laravel web app | Js' Technical Blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script type="text/javascript" src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" async></script><script>(adsbygoogle = window.adsbygoogle || []).push({
  google_ad_client: 'ca-pub-5448599905824559',
  enable_page_level_ads: true
});
</script><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-M7ZMK9N');
if ($('.tags > a').length > 0) {
  $('.tags > a').each(function (i) {
    dataLayer.push({
      'event': 'gaEvent',
      'gaEventCategory': 'Custom Dimension Event',
      'gaEventAction': 'Post tag',
      'gaEventLabel': $(this).text(),
      'gaEventValue': 0,
      'gaNonInteraction': 1,
      'gaDimensionsTag': $(this).text(),
      'gaMetricsTag': 1,
    });
  });
}
</script><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 5.4.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Enable AWS SES in Laravel web app</h1><a id="logo" href="/.">Js' Technical Blog</a><p class="description">This is my technical blog about programming, server setup &amp; configuration, technical learning experience.</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/short-notes/"><i class="fa fa-graduation-cap"> Short-Notes</i></a><a href="/about/"><i class="fa fa-user"> About</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Enable AWS SES in Laravel web app</h1><div class="post-meta">2021-05-09<script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a class="disqus-comment-count" data-disqus-identifier="blog/2021/05/09/Enable-AWS-SES-in-Laravel-web-app/" href="/blog/2021/05/09/Enable-AWS-SES-in-Laravel-web-app/#disqus_thread"></a><div class="post-content"><p>I believe most of AWS users will use Amazon Simple Email Service <strong>(SES)</strong><br>for system email sending.</p>
<p>Before you can use in production, by default it’s in <em>sandbox</em> mode, which<br>you are required to pre-configure a few email addresses to receive email.</p>
<p>You’re required to describe your use case, what you will use for, how<br>you will handle bounce back email, etc. in details.</p>
<p>E.g. You will be rejected if not provide enough information</p>
<p><img src="/images/posts/2021-05-09-Enable-AWS-SES-in-Laravel-web-app/request-ses-production.png" alt="Failed to apply SES production"></p>
<p>Let’s get started</p>
<hr>
<h2 id="1-Configure-in-AWS-console"><a href="#1-Configure-in-AWS-console" class="headerlink" title="1. Configure in AWS console"></a>1. Configure in AWS console</h2><p>Make sure you verify your domain.</p>
<p><img src="/images/posts/2021-05-09-Enable-AWS-SES-in-Laravel-web-app/verify-domain.png" alt="SES verify domain"></p>
<p>In order to verify, you need to add a TXT record to your DNS management.</p>
<p><img src="/images/posts/2021-05-09-Enable-AWS-SES-in-Laravel-web-app/ses-domain-txt-record.png" alt="SES domain TXT record"></p>
<p><img src="/images/posts/2021-05-09-Enable-AWS-SES-in-Laravel-web-app/dns-records.png" alt="Namecheap DNS management"></p>
<p>After domain, then add an email address <em>(the from email)</em></p>
<p><img src="/images/posts/2021-05-09-Enable-AWS-SES-in-Laravel-web-app/add-email-address.png" alt="sent from email"></p>
<p>Once added, make sure verify <strong>DKIM</strong> &amp; <strong>MAIL FROM Domain</strong>, just add a few records to DNS management</p>
<p>When using SES, must have this mechanism to handle bounced email.<br>Let say a spammer trick your system to keep blasting email to addresses that doesn’t exist,<br>SES may block the service.</p>
<h3 id="1-1-Create-SNS-topic"><a href="#1-1-Create-SNS-topic" class="headerlink" title="1.1. Create SNS topic"></a>1.1. Create SNS topic</h3><p><img src="/images/posts/2021-05-09-Enable-AWS-SES-in-Laravel-web-app/create-sns-topic.png" alt="Create SNS topic"></p>
<p>It’s something like a <em>event listener</em>, when some events happen, the listener will perform certain actions.</p>
<p>The <em>action</em> here means <em>subscription</em>, let’s create one</p>
<p><img src="/images/posts/2021-05-09-Enable-AWS-SES-in-Laravel-web-app/create-subscription.png" alt="Create SNS subscription"></p>
<p>And here, I’m using webhook with HTTPS endpoint</p>
<p><img src="/images/posts/2021-05-09-Enable-AWS-SES-in-Laravel-web-app/specify-endpoint.png" alt="Configure SNS subscription"></p>
<p>Make sure the endpoint is available, SNS will ping it for confirmation</p>
<p><img src="/images/posts/2021-05-09-Enable-AWS-SES-in-Laravel-web-app/sns-subscription-created.png" alt="SNS subscription confirmation"></p>
<h3 id="1-2-Configure-SES-to-link-with-SNS"><a href="#1-2-Configure-SES-to-link-with-SNS" class="headerlink" title="1.2. Configure SES to link with SNS"></a>1.2. Configure SES to link with SNS</h3><p>Go to <strong>Notifications</strong>, and edit</p>
<p><img src="/images/posts/2021-05-09-Enable-AWS-SES-in-Laravel-web-app/configure-ses-with-sns.png" alt="Configure SES to use SNS"></p>
<p>Set the <em>topic</em> to what you created just now</p>
<p><img src="/images/posts/2021-05-09-Enable-AWS-SES-in-Laravel-web-app/set-topic-to-ses.png" alt="Configure SES to use SNS topic"></p>
<h2 id="2-Email-Response-Handler"><a href="#2-Email-Response-Handler" class="headerlink" title="2. Email Response Handler"></a>2. Email Response Handler</h2><p>Remember, we’ve specified an endpoint to the topic subscription?</p>
<p>Let’s create the endpoint in <strong>routes/web.php</strong>. This will only be used by AWS</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">Route::post(<span class="string">&#x27;webhook/aws/ses-notification&#x27;</span>, [<span class="string">&#x27;uses&#x27;</span> =&gt; <span class="string">&#x27;SesController@sesNotification&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<p>Also, we need a table to keep all bounced emails</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php artisan <span class="built_in">make</span>:migration create_bounced_emails_table</span><br></pre></td></tr></table></figure>

<p>with this schema</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">Schema::create(<span class="string">&#x27;bounced_emails&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">Blueprint <span class="variable">$table</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$table</span>-&gt;string(<span class="string">&#x27;email&#x27;</span>)-&gt;primary();</span><br><span class="line">    <span class="variable">$table</span>-&gt;timestamps();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>In <strong>SesController.php</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Models</span>\<span class="title">BouncedEmail</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Aws</span>\<span class="title">Sns</span>\<span class="title">Message</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Aws</span>\<span class="title">Sns</span>\<span class="title">MessageValidator</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SesController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">const</span> NOTIFICATION_DELIVERY  = <span class="string">&#x27;Delivery&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> NOTIFICATION_BOUNCE    = <span class="string">&#x27;Bounce&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> NOTIFICATION_COMPLAINT = <span class="string">&#x27;Complaint&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sesNotification</span>(<span class="params">Request <span class="variable">$request</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$request</span>-&gt;method() !== <span class="string">&#x27;POST&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> response(<span class="string">&#x27;405 (Accept POST Only)&#x27;</span>, <span class="number">405</span>)-&gt;header(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/plain&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// only process valid message from aws</span></span><br><span class="line">            <span class="variable">$messageRaw</span> = Message::fromRawPostData();</span><br><span class="line">            <span class="variable">$validator</span>   = <span class="keyword">new</span> MessageValidator();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Note : Please Uncheck for Enable raw message delivery to comply with AWS SNS Validator format</span></span><br><span class="line">            <span class="keyword">if</span> (!<span class="variable">$validator</span>-&gt;isValid(<span class="variable">$messageRaw</span>)) &#123;</span><br><span class="line">                \Log::info(<span class="string">&#x27;Invalid AWS Message&#x27;</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> response(<span class="string">&#x27;405 (Invalid AWS Message)&#x27;</span>, <span class="number">405</span>)-&gt;header(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/plain&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$messageRaw</span> = <span class="variable">$messageRaw</span>-&gt;toArray();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$messageRaw</span>[<span class="string">&#x27;Type&#x27;</span>] === <span class="string">&#x27;Notification&#x27;</span>) &#123;</span><br><span class="line">                <span class="variable">$message</span> = json_decode(<span class="variable">$messageRaw</span>[<span class="string">&#x27;Message&#x27;</span>], <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">$this</span>-&gt;updateMailList(<span class="variable">$message</span>[<span class="string">&#x27;notificationType&#x27;</span>], <span class="variable">$message</span>[<span class="string">&#x27;mail&#x27;</span>][<span class="string">&#x27;destination&#x27;</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (\<span class="built_in">Exception</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">            <span class="comment">// Handle exception here</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> response(<span class="string">&#x27;OK&#x27;</span>)-&gt;header(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;text/plain&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">updateMailList</span>(<span class="params"><span class="variable">$snsType</span>, <span class="variable">$recipients</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$snsType</span> !== <span class="built_in">self</span>::NOTIFICATION_BOUNCE) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$recipients</span> <span class="keyword">as</span> <span class="variable">$recipient</span>) &#123;</span><br><span class="line">            <span class="variable">$email</span> = <span class="keyword">$this</span>-&gt;extractEmail(<span class="variable">$recipient</span>);</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$email</span>)) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$lookup</span> = BouncedEmail::find(<span class="variable">$email</span>);</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$lookup</span>)) &#123;</span><br><span class="line">                <span class="variable">$lookup</span> = <span class="keyword">new</span> BouncedEmail();</span><br><span class="line">                <span class="variable">$lookup</span>-&gt;email = <span class="variable">$email</span>;</span><br><span class="line">                <span class="variable">$lookup</span>-&gt;save();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Helper method to extract email</span></span><br><span class="line"><span class="comment">     * e.g. John Smith &lt;john<span class="doctag">@smith</span>.com&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $recipient</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">extractEmail</span>(<span class="params"><span class="variable">$recipient</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (filter_var(<span class="variable">$recipient</span>, FILTER_VALIDATE_EMAIL)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$recipient</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$pattern</span> = <span class="string">&#x27;/[a-z0-9_\-\+\.]+@[a-z0-9\-]+\.([a-z]&#123;2,4&#125;)(?:\.[a-z]&#123;2&#125;)?/i&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="variable">$pattern</span>, <span class="variable">$recipient</span>, <span class="variable">$matches</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$matches</span>[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Here’s the sample output of <code>$messageRaw</code></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Array</span><br><span class="line">(</span><br><span class="line">    <span class="selector-attr">[Type]</span> =&gt; Notification</span><br><span class="line">    <span class="selector-attr">[MessageId]</span> =&gt; <span class="number">11111111</span>-<span class="number">2222</span>-<span class="number">3333</span>-<span class="number">4444</span>-<span class="number">555555555555</span></span><br><span class="line">    <span class="selector-attr">[TopicArn]</span> =&gt; arn:aws:sns:ap-southeast-<span class="number">1</span>:<span class="number">999999999999</span>:ses-notification</span><br><span class="line">    <span class="selector-attr">[Message]</span> =&gt; &#123;<span class="string">&quot;notificationType&quot;</span>:<span class="string">&quot;Bounce&quot;</span>,<span class="string">&quot;bounce&quot;</span>:&#123;<span class="string">&quot;feedbackId&quot;</span>:<span class="string">&quot;aaaaaaaaaaaaaaaa-bbbbbbbb-cccc-dddd-eeee-ffffffffffff-000000&quot;</span>,<span class="string">&quot;bounceType&quot;</span>:<span class="string">&quot;Permanent&quot;</span>,<span class="string">&quot;bounceSubType&quot;</span>:<span class="string">&quot;OnAccountSuppressionList&quot;</span>,<span class="string">&quot;bouncedRecipients&quot;</span>:<span class="selector-attr">[&#123;<span class="string">&quot;emailAddress&quot;</span>:<span class="string">&quot;John &lt;test123123123123123@gmail.com&gt;&quot;</span>,<span class="string">&quot;action&quot;</span>:<span class="string">&quot;failed&quot;</span>,<span class="string">&quot;status&quot;</span>:<span class="string">&quot;5.1.1&quot;</span>,<span class="string">&quot;diagnosticCode&quot;</span>:<span class="string">&quot;Amazon SES did not send the message to this address because it is on the suppression list for your account. For more information about removing addresses from the suppression list, see the Amazon SES Developer Guide at https://docs.aws.amazon.com/ses/latest/DeveloperGuide/sending-email-suppression-list.html&quot;</span>&#125;]</span>,<span class="string">&quot;timestamp&quot;</span>:<span class="string">&quot;2021-05-08T14:35:45.000Z&quot;</span>,<span class="string">&quot;reportingMTA&quot;</span>:<span class="string">&quot;dns; amazonses.com&quot;</span>&#125;,<span class="string">&quot;mail&quot;</span>:&#123;<span class="string">&quot;timestamp&quot;</span>:<span class="string">&quot;2021-05-08T14:35:45.469Z&quot;</span>,<span class="string">&quot;source&quot;</span>:<span class="string">&quot;noreply@yoursite.com&quot;</span>,<span class="string">&quot;sourceArn&quot;</span>:<span class="string">&quot;arn:aws:ses:ap-southeast-1:999999999999:identity/noreply@yoursite.com&quot;</span>,<span class="string">&quot;sourceIp&quot;</span>:<span class="string">&quot;202.202.202.202&quot;</span>,<span class="string">&quot;sendingAccountId&quot;</span>:<span class="string">&quot;999999999999&quot;</span>,<span class="string">&quot;messageId&quot;</span>:<span class="string">&quot;1111111111111111-22222222-3333-4444-5555-666666666666-000000&quot;</span>,<span class="string">&quot;destination&quot;</span>:<span class="selector-attr">[<span class="string">&quot;John &lt;test123123123123123@gmail.com&gt;&quot;</span>]</span>,<span class="string">&quot;headersTruncated&quot;</span>:false,<span class="string">&quot;headers&quot;</span>:<span class="selector-attr">[&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;Message-ID&quot;</span>,<span class="string">&quot;value&quot;</span>:<span class="string">&quot;&lt;99999999999999999999999999999999@swift.generated&gt;&quot;</span>&#125;,&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;Date&quot;</span>,<span class="string">&quot;value&quot;</span>:<span class="string">&quot;Sat, 08 May 2021 22:35:44 +0800&quot;</span>&#125;,&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;Subject&quot;</span>,<span class="string">&quot;value&quot;</span>:<span class="string">&quot;YourSite: Test send mail&quot;</span>&#125;,&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;From&quot;</span>,<span class="string">&quot;value&quot;</span>:<span class="string">&quot;YourSite &lt;noreply@yoursite.com&gt;&quot;</span>&#125;,&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;To&quot;</span>,<span class="string">&quot;value&quot;</span>:<span class="string">&quot;John &lt;test123123123123123@gmail.com&gt;&quot;</span>&#125;,&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;MIME-Version&quot;</span>,<span class="string">&quot;value&quot;</span>:<span class="string">&quot;1.0&quot;</span>&#125;,&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;Content-Type&quot;</span>,<span class="string">&quot;value&quot;</span>:<span class="string">&quot;multipart/mixed; boundary=\&quot;_=_swift_5555555555_77777777777777777777777777777777_=_\&quot;&quot;</span>&#125;]</span>,<span class="string">&quot;commonHeaders&quot;</span>:&#123;<span class="string">&quot;from&quot;</span>:<span class="selector-attr">[<span class="string">&quot;YourSite &lt;noreply@yoursite.com&gt;&quot;</span>]</span>,<span class="string">&quot;date&quot;</span>:<span class="string">&quot;Sat, 08 May 2021 22:35:44 +0800&quot;</span>,<span class="string">&quot;to&quot;</span>:<span class="selector-attr">[<span class="string">&quot;John &lt;test123123123123123@gmail.com&gt;&quot;</span>]</span>,<span class="string">&quot;messageId&quot;</span>:<span class="string">&quot;&lt;99999999999999999999999999999999@swift.generated&gt;&quot;</span>,<span class="string">&quot;subject&quot;</span>:<span class="string">&quot;YourSite: Test send mail&quot;</span>&#125;&#125;&#125;</span><br><span class="line">    <span class="selector-attr">[Timestamp]</span> =&gt; <span class="number">2021</span>-<span class="number">05</span>-<span class="number">08</span>T14:<span class="number">35</span>:<span class="number">45.908</span>Z</span><br><span class="line">    <span class="selector-attr">[SignatureVersion]</span> =&gt; <span class="number">1</span></span><br><span class="line">    <span class="selector-attr">[Signature]</span> =&gt; UUUUUUUUUUUUUUUUUUUUUUUUUUUUU+kkkkkkkkkkk/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC/zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz/eeeee/qqqqqqqq+BBB+nnnnnnnnnnnnnnnnnnnnnnnnnn/e/yyyyyyyyyyy+dddd+XXXXXXXXXXXXXXXXXXXXXXXXX/ww/rr+HHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHHH+g==</span><br><span class="line">    <span class="selector-attr">[SigningCertURL]</span> =&gt; https:<span class="comment">//sns.ap-southeast-1.amazonaws.com/SimpleNotificationService-99999999999999999999999999999999.pem</span></span><br><span class="line">    <span class="selector-attr">[UnsubscribeURL]</span> =&gt; https:<span class="comment">//sns.ap-southeast-1.amazonaws.com/?Action=Unsubscribe&amp;SubscriptionArn=arn:aws:sns:ap-southeast-1:999999999999:ses-notification:11111111-2222-3333-4444-555555555555</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="3-Prevent-to-send-to-invalid-email"><a href="#3-Prevent-to-send-to-invalid-email" class="headerlink" title="3. Prevent to send to invalid email"></a>3. Prevent to send to invalid email</h3><p>In <a target="_blank" rel="noopener" href="https://laravel.com/docs/8.x/notifications">Laravel Notification</a> feature, there’s a <code>via</code> method</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">via</span>(<span class="params"><span class="variable">$notifiable</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$channels</span> = [];</span><br><span class="line">    <span class="variable">$bounced</span> = BouncedEmail::find(<span class="variable">$notifiable</span>-&gt;routeNotificationForMail());</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$bounced</span>)) &#123; <span class="comment">// only send if it&#x27;s not in the bounced list</span></span><br><span class="line">        <span class="variable">$channels</span>[] = <span class="string">&#x27;mail&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$channels</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a class="article-share-link" data-url="http://jslim.net/blog/2021/05/09/Enable-AWS-SES-in-Laravel-web-app/" data-id="ckpgugvkf00l6hqne7qlvhzmn" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACsElEQVR42u3a0W7iUAwEUP7/p3efV7Qwc31Nu9LhqWohyUml2Iz9eMSvP0+v737//Nfvjpaft/1U/cLDw8MbX/rrC33+a3Kc5GjJ7cuvGQ8PD2+bN38oJ+DkLK9vX11y8PDw8H4Nb6ONfv1ZPDw8vP+RN2l522Jz9lk8PDy8T/LyUOD1yeaX1Z7lWtaCh4eHF/Mmg6if+nllvoeHh4c3nqpP2ug2xp0Xgy/OhYeHh7fAO1sdOFvGOgtwkxD5zfvx8PDwrvLasLUtA3lIkYfIOR4PDw9vm3drcJXg80f8pDzg4eHhbfDyB/qtdatJKWoXs/Dw8PA2eG2TmgeyyVC/PUteZvDw8PC2eUmz254sCRraJrtu9PHw8PCWeWdf+5MQYR5G1CUBDw8Pb423caB8WNUWgHwkhoeHh/d5Xlsw2oA1X8/KG/roH4CHh4c35uWjqbzxbcdpk3DkTTCBh4eHt8CbA/KyMW/Z81a7uGg8PDy8kpevWOUP6PY9iyEIHh4e3gd5k8a6jQzyda6kwPxzHDw8PLwP8vJG9laE0ZaiqE3Hw8PDW+DNB/+TdYT5GKx9Dx4eHt6cd/bgnn/Tb2OIfJPqi/keHh4e3lVe+7ifjL7aKOEsLH5MqhkeHh5emb6eLTm1AcHh4tTRkfHw8PD2eHlb3A7+by0i5EtXoywEDw8PbxDd3nqU5+8/Kw/RTcTDw8Nb5rVRbD6ymqwXtJHuI6k8eHh4eEe8uxFq0ojnCwrtgO2RHAgPDw9vzDsbz0+ChrN1hLP2HQ8PD2+Pd9ZSt8sEe9P8N7cPDw8Pb42XD8bORmXJwKy9QafxCx4eHt7P8M4697PwYrRGgIeHh/cLeJMxf3tTJkM4PDw8vG3e2epAHvvu3b6VGBcPDw/v0gAsvx3tGCxfxmoDZTw8PLyrvL/UtI2qCmWX9QAAAABJRU5ErkJggg==">Share</a><div class="tags"><a href="/tags/php/"><i class="fa fa-tag"></i>php</a><a href="/tags/laravel/"><i class="fa fa-tag"></i>laravel</a><a href="/tags/aws/"><i class="fa fa-tag"></i>aws</a></div><div class="post-nav"><a class="pre" href="/blog/2021/06/03/Shell-script-remove-lines-contain-some-words/">Shell script - remove lines contain some words</a><a class="next" href="/blog/2021/02/25/AWS-EC2-instance-used-up-CPU-100-Malware-kdevtmpfsi/">AWS EC2 instance used up CPU 100% - Malware kdevtmpfsi</a></div><div id="disqus_thread"><div class="btn_click_load"><button class="disqus_click_btn">阅读评论（请确保 Disqus 可以正常加载）</button></div><script type="text/javascript">var disqus_config = function () {
    this.page.url = 'http://jslim.net/blog/2021/05/09/Enable-AWS-SES-in-Laravel-web-app/';
    this.page.identifier = 'blog/2021/05/09/Enable-AWS-SES-in-Laravel-web-app/';
    this.page.title = 'Enable AWS SES in Laravel web app';
  };</script><script type="text/javascript" id="disqus-lazy-load-script">$.ajax({
url: 'https://disqus.com/next/config.json',
timeout: 2500,
type: 'GET',
success: function(){
  var d = document;
  var s = d.createElement('script');
  s.src = '//jslim89.disqus.com/embed.js';
  s.setAttribute('data-timestamp', + new Date());
  (d.head || d.body).appendChild(s);
  $('.disqus_click_btn').css('display', 'none');
},
error: function() {
  $('.disqus_click_btn').css('display', 'block');
}
});</script><script type="text/javascript" id="disqus-click-load">$('.btn_click_load').click(() => {  //click to load comments
    (() => { // DON'T EDIT BELOW THIS LINE
        var d = document;
        var s = d.createElement('script');
        s.src = '//jslim89.disqus.com/embed.js';
        s.setAttribute('data-timestamp', + new Date());
        (d.head || d.body).appendChild(s);
    })();
    $('.disqus_click_btn').css('display','none');
});</script><script type="text/javascript" id="disqus-count-script">$(function() {
     var xhr = new XMLHttpRequest();
     xhr.open('GET', '//disqus.com/next/config.json', true);
     xhr.timeout = 2500;
     xhr.onreadystatechange = function () {
       if (xhr.readyState === 4 && xhr.status === 200) {
         $('.post-meta .post-comments-count').show();
         var s = document.createElement('script');
         s.id = 'dsq-count-scr';
         s.src = 'https://jslim89.disqus.com/count.js';
         s.async = true;
         (document.head || document.body).appendChild(s);
       }
     };
     xhr.ontimeout = function () { xhr.abort(); };
     xhr.send(null);
   });
</script></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://jslim.net"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/setup-configuration/" style="font-size: 15px;">setup-configuration</a> <a href="/tags/vim/" style="font-size: 15px;">vim</a> <a href="/tags/subversion/" style="font-size: 15px;">subversion</a> <a href="/tags/fedora/" style="font-size: 15px;">fedora</a> <a href="/tags/gnome/" style="font-size: 15px;">gnome</a> <a href="/tags/windows/" style="font-size: 15px;">windows</a> <a href="/tags/php/" style="font-size: 15px;">php</a> <a href="/tags/programming/" style="font-size: 15px;">programming</a> <a href="/tags/os-x/" style="font-size: 15px;">os-x</a> <a href="/tags/mac/" style="font-size: 15px;">mac</a> <a href="/tags/command-line/" style="font-size: 15px;">command-line</a> <a href="/tags/ruby/" style="font-size: 15px;">ruby</a> <a href="/tags/octopress/" style="font-size: 15px;">octopress</a> <a href="/tags/shell-script/" style="font-size: 15px;">shell-script</a> <a href="/tags/ios/" style="font-size: 15px;">ios</a> <a href="/tags/uninstallation/" style="font-size: 15px;">uninstallation</a> <a href="/tags/javascript/" style="font-size: 15px;">javascript</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/sql/" style="font-size: 15px;">sql</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/django/" style="font-size: 15px;">django</a> <a href="/tags/mysql/" style="font-size: 15px;">mysql</a> <a href="/tags/vmware/" style="font-size: 15px;">vmware</a> <a href="/tags/zend/" style="font-size: 15px;">zend</a> <a href="/tags/c-language/" style="font-size: 15px;">c language</a> <a href="/tags/wordpress/" style="font-size: 15px;">wordpress</a> <a href="/tags/configuration/" style="font-size: 15px;">configuration</a> <a href="/tags/apache/" style="font-size: 15px;">apache</a> <a href="/tags/laravel/" style="font-size: 15px;">laravel</a> <a href="/tags/nodejs/" style="font-size: 15px;">nodejs</a> <a href="/tags/sails-js/" style="font-size: 15px;">sails.js</a> <a href="/tags/nginx/" style="font-size: 15px;">nginx</a> <a href="/tags/css/" style="font-size: 15px;">css</a> <a href="/tags/bootstrap3/" style="font-size: 15px;">bootstrap3</a> <a href="/tags/deployment/" style="font-size: 15px;">deployment</a> <a href="/tags/jquery/" style="font-size: 15px;">jquery</a> <a href="/tags/google-map/" style="font-size: 15px;">google-map</a> <a href="/tags/flot/" style="font-size: 15px;">flot</a> <a href="/tags/graph/" style="font-size: 15px;">graph</a> <a href="/tags/happyfox/" style="font-size: 15px;">happyfox</a> <a href="/tags/server/" style="font-size: 15px;">server</a> <a href="/tags/laravel4/" style="font-size: 15px;">laravel4</a> <a href="/tags/objective-c/" style="font-size: 15px;">objective-c</a> <a href="/tags/cocos2d-x/" style="font-size: 15px;">cocos2d-x</a> <a href="/tags/xcode/" style="font-size: 15px;">xcode</a> <a href="/tags/swift/" style="font-size: 15px;">swift</a> <a href="/tags/payment-gateway/" style="font-size: 15px;">payment-gateway</a> <a href="/tags/debian/" style="font-size: 15px;">debian</a> <a href="/tags/branding/" style="font-size: 15px;">branding</a> <a href="/tags/ruby-on-rails/" style="font-size: 15px;">ruby-on-rails</a> <a href="/tags/selenium/" style="font-size: 15px;">selenium</a> <a href="/tags/phantomjs/" style="font-size: 15px;">phantomjs</a> <a href="/tags/test/" style="font-size: 15px;">test</a> <a href="/tags/security/" style="font-size: 15px;">security</a> <a href="/tags/vagrant/" style="font-size: 15px;">vagrant</a> <a href="/tags/google-api/" style="font-size: 15px;">google-api</a> <a href="/tags/e-commerce/" style="font-size: 15px;">e-commerce</a> <a href="/tags/facebook-php-sdk/" style="font-size: 15px;">facebook-php-sdk</a> <a href="/tags/setup/" style="font-size: 15px;">setup</a> <a href="/tags/cronjob/" style="font-size: 15px;">cronjob</a> <a href="/tags/DirectAdmin/" style="font-size: 15px;">DirectAdmin</a> <a href="/tags/ads-platform/" style="font-size: 15px;">ads-platform</a> <a href="/tags/windows-form-application/" style="font-size: 15px;">windows-form-application</a> <a href="/tags/hacking/" style="font-size: 15px;">hacking</a> <a href="/tags/session-hijacking/" style="font-size: 15px;">session-hijacking</a> <a href="/tags/banned/" style="font-size: 15px;">banned</a> <a href="/tags/scam/" style="font-size: 15px;">scam</a> <a href="/tags/aws/" style="font-size: 15px;">aws</a> <a href="/tags/ssh/" style="font-size: 15px;">ssh</a> <a href="/tags/webapp/" style="font-size: 15px;">webapp</a> <a href="/tags/c/" style="font-size: 15px;">c#</a> <a href="/tags/winform/" style="font-size: 15px;">winform</a> <a href="/tags/nappupdate/" style="font-size: 15px;">nappupdate</a> <a href="/tags/devops/" style="font-size: 15px;">devops</a> <a href="/tags/homestead/" style="font-size: 15px;">homestead</a> <a href="/tags/paypal/" style="font-size: 15px;">paypal</a> <a href="/tags/angular/" style="font-size: 15px;">angular</a> <a href="/tags/cefsharp/" style="font-size: 15px;">cefsharp</a> <a href="/tags/http/" style="font-size: 15px;">http</a> <a href="/tags/guest-post/" style="font-size: 15px;">guest-post</a> <a href="/tags/ubuntu/" style="font-size: 15px;">ubuntu</a> <a href="/tags/utf-8/" style="font-size: 15px;">utf-8</a> <a href="/tags/config/" style="font-size: 15px;">config</a> <a href="/tags/mysql-client/" style="font-size: 15px;">mysql-client</a> <a href="/tags/lambda/" style="font-size: 15px;">lambda</a> <a href="/tags/node/" style="font-size: 15px;">node</a> <a href="/tags/js/" style="font-size: 15px;">js</a> <a href="/tags/tinymce/" style="font-size: 15px;">tinymce</a> <a href="/tags/guzzle/" style="font-size: 15px;">guzzle</a> <a href="/tags/laravel5/" style="font-size: 15px;">laravel5</a> <a href="/tags/eloquent/" style="font-size: 15px;">eloquent</a> <a href="/tags/subquery/" style="font-size: 15px;">subquery</a> <a href="/tags/oembed/" style="font-size: 15px;">oembed</a> <a href="/tags/datatables/" style="font-size: 15px;">datatables</a> <a href="/tags/google-analytics/" style="font-size: 15px;">google-analytics</a> <a href="/tags/google/" style="font-size: 15px;">google</a> <a href="/tags/gitlab/" style="font-size: 15px;">gitlab</a> <a href="/tags/rds/" style="font-size: 15px;">rds</a> <a href="/tags/openvpn/" style="font-size: 15px;">openvpn</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/blog/2021/06/03/Shell-script-remove-lines-contain-some-words/">Shell script - remove lines contain some words</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2021/05/09/Enable-AWS-SES-in-Laravel-web-app/">Enable AWS SES in Laravel web app</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2021/02/25/AWS-EC2-instance-used-up-CPU-100-Malware-kdevtmpfsi/">AWS EC2 instance used up CPU 100% - Malware kdevtmpfsi</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2021/02/08/Real-world-practice-on-Docker-in-Laravel-web-app/">Real world practice on Docker in Laravel web app</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2021/02/02/Laravel-Unit-Test-Mail-Send/">Laravel Unit Test Mail Send</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2020/11/06/Thinkpad-Set-battery-charging-threshold-in-Linux/">Thinkpad - Set battery charging threshold in Linux</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2020/04/24/Activate-Windows-10-in-VirtualBox/">Activate Windows 10 in VirtualBox</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2020/02/11/Web-development-testing-in-Android-Virtual-Device/">Web development testing in Android Virtual Device</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2020/01/22/Install-Arch-Linux/">Install Arch Linux</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2020/01/09/Why-Vue-js-emit-not-working/">Why Vue.js $emit not working</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> Recent Comments</i></div><script type="text/javascript" src="//jslim89.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Links</i></div><ul></ul><a href="http://blog.jsl.im" title="Js' Journey" target="_blank">Js' Journey</a></div><div class="affiliates"><div><a href="https://luminati.io/?affiliate=ref_5d2fff2b8fcb5320de59b227&amp;cam=L_yairi" title="The largest proxy network" target="_blank"><img src="/images/ads/lum_ad_250x250.png"/></a></div><div><a href="https://m.do.co/c/abb622813f68" title="Deploy your next app in seconds. Get $50 in cloud credits from @DigitalOcean" target="_blank"><img src="/images/ads/DigitalOcean_300x250.gif" style="width:250px;height:auto;"/></a></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2021 <a href="/." rel="nofollow">Js' Technical Blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="/js/copycode.js" successtext="Copy Successed!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>