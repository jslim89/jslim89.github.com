---
layout: post
title: "ZXingObjc encode QR code"
date: 2014-06-26 11:47:39 +0800
comments: true
tags: 
- ios
---

To generate QR code in iOS device, I'm using [this library](https://github.com/TheLevelUp/ZXingObjC).

From the their GitHub repo, already got the instruction. Here I want to point out 2 things:

## 1. Assign to `UIImage`

```obj-c
NSString *text = @"The text to encode";
NSError *error = nil;
ZXMultiFormatWriter *writer = [ZXMultiFormatWriter writer];
ZXBitMatrix* result = [writer encode:text
                              format:kBarcodeFormatQRCode
                               width:500
                              height:500
                               error:&error];
if (result) {
    CGImageRef image = [[ZXImage imageWithMatrix:result] cgimage];

    // LOOK AT HERE, this line will crash
    imageView.image = [[UIImage alloc] initWithCGImage:image];
} else {
    NSLog(@"QR code encode error %@", [error localizedDescription]);
}
```

See the code above, it will crash when convert `CGImageRef` to `UIImage`.
So change to

```obj-c
UIImage *image = [[UIImage alloc] initWithCGImage:[[ZXImage imageWithMatrix:result] cgimage]];
imageView.image = image;
```

It works now. This is something to do with ARC, [checkout this for more info](http://stackoverflow.com/questions/12756295/uiimage-from-cgimageref)

## 2. It has margin

![QR code with margin](http://jslim89.github.com/images/posts/2014-06-26-zxingobjc-encode-qr-code/margin.png)

You can see the margin took out some space. To remove the margin

```obj-c
...

// ADD THIS 2 LINES
ZXEncodeHints *hints = [ZXEncodeHints hints];
hints.margin = @0;

ZXBitMatrix* result = [writer encode:text
                              format:kBarcodeFormatQRCode
                               width:500
                              height:500
                              hints:hints // ADD THIS LINE
                               error:&error];
...
```

Run it again, now it utilise the whole image.

![QR code without margin](http://jslim89.github.com/images/posts/2014-06-26-zxingobjc-encode-qr-code/no-margin.png)

_References:_

* _[Objective C: How to convert CGImageRef to UIImageView?](http://stackoverflow.com/questions/23609593/objective-c-how-to-convert-cgimageref-to-uiimageview/23610576#23610576)_
* _[Reduce border width on QR Codes generated by ZXing?](http://stackoverflow.com/questions/10142748/reduce-border-width-on-qr-codes-generated-by-zxing)_
